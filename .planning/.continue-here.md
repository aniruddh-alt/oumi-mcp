---
phase: pre-initialization
task: 0
total_tasks: 20
status: in_progress
last_updated: 2026-02-26T22:39:09.863Z
---

<current_state>
GSD new-project initialization was just started (Step 1 `init` ran successfully).
The project has NOT been initialized through GSD yet — no PROJECT.md, REQUIREMENTS.md,
ROADMAP.md, or config.json exist. However, a complete design doc and implementation plan
already exist from a prior brainstorming session.
</current_state>

<completed_work>

## This Session
- Code review of feature/cloud-runs branch (20 commits, +12,804/-1,117 lines)
- Identified 12 code bugs across job_service.py and server.py
- Identified 14 test gaps
- Created GitHub Issue #2 with user feedback (5 friction points + guidance improvements)
- Brainstorming skill: explored approaches, got user approval on design
- Design doc written: `docs/plans/2026-02-26-issue2-fixes-design.md`
- Implementation plan written: `docs/plans/2026-02-26-issue2-implementation-plan.md`
- Started GSD new-project but ran out of context at Step 1

## Key Design Decisions
- **launcher.status() is the source of truth** — registry becomes thin ID mapping only
- **JobRecord loses `status` field** — status always queried live from launcher or rt.process
- **_runtimes eviction** — cloud job runtimes evicted after launch completes
- **Cancel writes "cancelled" not "failed"** — distinguishable terminal states
- **validate_datasets gets client_cwd** — fixes MCP CWD bug
- **Dead code removal** — _check_env_overrides, import re, env_warnings response key
- **Phased by layer** — Phase 1: job_service registry refactor → Phase 2: server fixes → Phase 3: guidance → Phase 4: tests
- **Cohesive refactor** (not surgical fixes) for cancel/runtime lifecycle
- **Include tests** alongside code fixes
- User preference: **no co-author lines** in commits
</completed_work>

<remaining_work>

## GSD Initialization Needed
The GSD project needs to be initialized from scratch. The `init new-project` command ran
and detected: brownfield, needs_codebase_map=true, has_existing_code=true.

However, we already have:
- Design doc: `docs/plans/2026-02-26-issue2-fixes-design.md`
- Implementation plan: `docs/plans/2026-02-26-issue2-implementation-plan.md` (20 tasks, 4 phases)

## The 20 Implementation Tasks (from the plan)

**Phase 1: Registry Refactor (job_service.py)**
1. Remove `status` field from JobRecord
2. Simplify JobRegistry — age-based pruning only
3. Add `_runtimes` eviction (evict_runtime, cleanup_stale_runtimes)
4. Rewrite cancel() — "cancelled" status, fix race condition
5. Fix `_get_cloud_logs` thread safety (remove cross-thread stream.close)
6. Simplify poll_status — remove registry status writes
7. Update server.py — remove status from JobRecord creation/helpers
8. Update cancel_job in server — check live status before cancelling

**Phase 2: Server Bug Fixes (server.py)**
9. Fix validate_datasets CWD (add client_cwd parameter)
10. Surface not_found_warning + fix suggested_configs + remove dead code

**Phase 3: Guidance Content (mle_prompt.py)**
11. Add ephemeral storage + sky exec warnings to CLOUD_LAUNCH_RESOURCE
12. Add version compat, inference output schema, eval caveats

**Phase 4: Tests**
13. Rewrite test_job_registry.py for new registry
14. Add validate_datasets client_cwd test
15. Fix test_relative_path_exists_locally_still_unreachable
16. Add cancel_job end-to-end + cancel timeout tests
17. Add _launch_cloud with client_cwd test
18. Add list_jobs via launcher.status() test
19. Final integration pass — run all tests, fix breakage
20. Final commit — update design doc
</remaining_work>

<decisions_made>

- User chose "Both — full pass" (code bugs + guidance + tests)
- User chose "Cohesive refactor" over surgical fixes for cancel/runtime
- User chose "Include tests" alongside code fixes
- User chose "Approach 1: By Layer" (bottom-up: job_service → server → guidance → tests)
- User chose "Replace entire plan" to make launcher.status() the organizing principle
- User chose "Remove entirely" for _check_env_overrides infrastructure
- GSD execution with subagents (not parallel session)
</decisions_made>

<blockers>
- None technical. Just ran out of context window.
</blockers>

<context>
The user wants to use GSD workflow to execute the implementation plan with subagents.
The design and plan are already written and approved. The GSD new-project flow should
be initialized using the existing design doc as the idea document. Since the plan already
exists with 20 concrete tasks across 4 phases, the GSD roadmap should map directly to
these 4 phases.

The brownfield detection suggested mapping the codebase, but the user already has deep
context — skip codebase mapping and use the existing docs/plans/ as input.

Key files:
- job_service.py: 1,244 lines — job execution, registry, cancel, logs
- server.py: 3,078 lines — MCP tools, pre-flight, status helpers
- models.py: 463 lines — TypedDict response types
- mle_prompt.py: 717 lines — guidance resource content
- Oumi launcher source: /Users/aniruddhanramesh/dev/oumi/projects/oumi/src/oumi/launcher/
</context>

<next_action>
Resume with `/gsd:resume-work`. The next step is:

1. Skip codebase mapping (we already understand the codebase deeply)
2. Initialize GSD project using the existing design doc as input:
   - `docs/plans/2026-02-26-issue2-fixes-design.md` as the idea document
   - `docs/plans/2026-02-26-issue2-implementation-plan.md` as the detailed plan
3. Create PROJECT.md, REQUIREMENTS.md, ROADMAP.md from existing plan
4. Then execute phases with `/gsd:execute-phase`
</next_action>
